// memory-flip-game.js (Telegram Mini App)
// Простая логика Memory Flip игры с пулом из 3 игроков и токенами

const gameState = {
  players: [],
  tokens: {},
  roundStarted: false,
  cards: [],
  matchedPairs: 0,
  startTime: null,
};

function initGame() {
  gameState.players = [];
  gameState.tokens = {};
  gameState.cards = shuffleCards(generateCardPairs());
  gameState.roundStarted = false;
  gameState.matchedPairs = 0;
  gameState.startTime = null;
}

function addPlayer(playerId) {
  if (gameState.players.length < 3 && !gameState.players.includes(playerId)) {
    gameState.players.push(playerId);
    gameState.tokens[playerId] = 3;
  }
  if (gameState.players.length === 3) startRound();
}

function startRound() {
  gameState.roundStarted = true;
  gameState.startTime = Date.now();
  gameState.players.forEach(pid => {
    gameState.tokens[pid]--;
  });
}

function generateCardPairs() {
  const values = ['A', 'B', 'C', 'D', 'E', 'F'];
  return [...values, ...values];
}

function shuffleCards(cards) {
  return cards.sort(() => Math.random() - 0.5);
}

function flipCard(playerId, index) {
  // Логика переворота и сопоставления карт
  // Упрощенно: каждый игрок просто находит пару
  gameState.matchedPairs++;
  if (gameState.matchedPairs === 6) endRound();
}

function endRound() {
  const elapsedTime = (Date.now() - gameState.startTime) / 1000;
  const winner = gameState.players[Math.floor(Math.random() * 3)];
  gameState.tokens[winner] += 3;
  console.log(`Победитель: ${winner}, Время: ${elapsedTime} секунд`);
  initGame();
}

// Пример использования (в реальном проекте привязывается к Telegram WebApp):
initGame();
addPlayer('player1');
addPlayer('player2');
addPlayer('player3');
// Игроки делают ходы
flipCard('player1', 0);
flipCard('player2', 1);
flipCard('player3', 2);
