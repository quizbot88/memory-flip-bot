import React from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { motion } from "framer-motion";
import { Coins } from "lucide-react";

const cards = [
  { id: 1, icon: "üçí" },
  { id: 2, icon: "üçí" },
  { id: 3, icon: "üçã" },
  { id: 4, icon: "üçã" },
  { id: 5, icon: "üçá" },
  { id: 6, icon: "üçá" },
];

export default function MemoryFlipGame() {
  const [flipped, setFlipped] = React.useState([]);
  const [matched, setMatched] = React.useState([]);
  const [tokens, setTokens] = React.useState(3);
  const [gameOver, setGameOver] = React.useState(false);

  const handleFlip = (id) => {
    if (flipped.length === 2 || flipped.includes(id) || gameOver) return;

    const newFlipped = [...flipped, id];
    setFlipped(newFlipped);

    if (newFlipped.length === 2) {
      const [first, second] = newFlipped;
      const firstCard = cards.find((c) => c.id === first);
      const secondCard = cards.find((c) => c.id === second);
      if (firstCard.icon === secondCard.icon) {
        setMatched([...matched, first, second]);
      }
      setTimeout(() => setFlipped([]), 1000);
    }
  };

  const restartGame = () => {
    if (tokens <= 0) return;
    setFlipped([]);
    setMatched([]);
    setGameOver(false);
    setTokens(tokens - 1);
  };

  React.useEffect(() => {
    if (matched.length === cards.length) {
      setGameOver(true);
      setTokens(tokens + 3); // –ø—Ä–∏–∑ –∑–∞ –ø–æ–±–µ–¥—É
    }
  }, [matched]);

  return (
    <div className="flex flex-col items-center gap-6 p-6">
      <div className="text-2xl font-bold">Memory Flip</div>
      <div className="flex items-center gap-2 text-lg">
        <Coins className="w-5 h-5" /> {tokens} –∫–∏—Ç–∫–æ–∏–Ω–æ–≤
      </div>
      <div className="grid grid-cols-3 gap-4">
        {cards.map((card) => {
          const isFlipped = flipped.includes(card.id) || matched.includes(card.id);
          return (
            <motion.div
              key={card.id}
              whileTap={{ scale: 0.95 }}
              className="cursor-pointer"
              onClick={() => handleFlip(card.id)}
            >
              <Card className="w-20 h-24 flex items-center justify-center text-2xl">
                <CardContent>
                  {isFlipped ? card.icon : "‚ùì"}
                </CardContent>
              </Card>
            </motion.div>
          );
        })}
      </div>
      <Button onClick={restartGame} disabled={tokens <= 0} className="mt-4">
        {tokens <= 0 ? "–ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤" : gameOver ? "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞" : "–†–µ—Å—Ç–∞—Ä—Ç"}
      </Button>
    </div>
  );
}
